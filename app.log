

> wapp-poc@1.0.0 start
> node server.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
üöÄ Servidor rodando na porta 3000
[Webhook] ‚úÖ Verificado com sucesso
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "1535276744056597",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "551153050027",
              "phone_number_id": "911344615386648"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Marcelo Ferracini"
                },
                "wa_id": "5511958711770"
              }
            ],
            "messages": [
              {
                "from": "5511958711770",
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBNzc1RjI2MkU3NzQxODJBMzdGAA==",
                "timestamp": "1763807627",
                "text": {
                  "body": "Ol√°"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: [
  {
    "from": "5511958711770",
    "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBNzc1RjI2MkU3NzQxODJBMzdGAA==",
    "timestamp": "1763807627",
    "text": {
      "body": "Ol√°"
    },
    "type": "text"
  }
]
[Debug] Contatos extra√≠dos: [
  {
    "profile": {
      "name": "Marcelo Ferracini"
    },
    "wa_id": "5511958711770"
  }
]
Mensagem recebida de 5511958711770: Ol√°
[OpenAI] Gerando resposta...
[OpenAI] Resposta gerada: Ol√°! Como posso ajud√°-lo hoje? Se tiver alguma d√∫vida ou precisar de informa√ß√µes, estou aqui para ajudar!
[POST Meta] URL: https://graph.facebook.com/v22.0/775904258949205/messages
[POST Meta] Body: {
  "messaging_product": "whatsapp",
  "to": "5511958711770",
  "type": "text",
  "text": {
    "body": "Ol√°! Como posso ajud√°-lo hoje? Se tiver alguma d√∫vida ou precisar de informa√ß√µes, estou aqui para ajudar!"
  }
}
‚úÖ Resposta enviada com sucesso para 5511958711770
[POST Meta] Response: {
  "messaging_product": "whatsapp",
  "contacts": [
    {
      "input": "5511958711770",
      "wa_id": "5511958711770"
    }
  ],
  "messages": [
    {
      "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjI0NTQ1ODhDOTgxNzg4RDI4MgA="
    }
  ]
}
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjI0NTQ1ODhDOTgxNzg4RDI4MgA=",
                "status": "sent",
                "timestamp": "1763807632",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjI0NTQ1ODhDOTgxNzg4RDI4MgA=",
                "status": "delivered",
                "timestamp": "1763807633",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjI0NTQ1ODhDOTgxNzg4RDI4MgA=",
                "status": "delivered",
                "timestamp": "1763807633",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "1535276744056597",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "551153050027",
              "phone_number_id": "911344615386648"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Marcelo Ferracini"
                },
                "wa_id": "5511958711770"
              }
            ],
            "messages": [
              {
                "context": {
                  "from": "5511958711770",
                  "id": "wacid.HBgNNTUxMTk1ODcxMTc3MBUCABIYIEE0QTdGRTY4QkQwNkY1REMxNjg2RUZGREI2OTRBMUEwHBgMNTUxMTUzMDUwMDI3FQIAFSAA"
                },
                "from": "5511958711770",
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBNDkxQUUxQ0M2ODdCNTBBMDg3AA==",
                "timestamp": "1763807691",
                "type": "interactive",
                "interactive": {
                  "type": "call_permission_reply",
                  "call_permission_reply": {
                    "response": "accept",
                    "expiration_timestamp": 1764412491,
                    "response_source": "user_action"
                  }
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: [
  {
    "context": {
      "from": "5511958711770",
      "id": "wacid.HBgNNTUxMTk1ODcxMTc3MBUCABIYIEE0QTdGRTY4QkQwNkY1REMxNjg2RUZGREI2OTRBMUEwHBgMNTUxMTUzMDUwMDI3FQIAFSAA"
    },
    "from": "5511958711770",
    "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBNDkxQUUxQ0M2ODdCNTBBMDg3AA==",
    "timestamp": "1763807691",
    "type": "interactive",
    "interactive": {
      "type": "call_permission_reply",
      "call_permission_reply": {
        "response": "accept",
        "expiration_timestamp": 1764412491,
        "response_source": "user_action"
      }
    }
  }
]
[Debug] Contatos extra√≠dos: [
  {
    "profile": {
      "name": "Marcelo Ferracini"
    },
    "wa_id": "5511958711770"
  }
]
Mensagem recebida de 5511958711770: undefined
[OpenAI] Gerando resposta...
[OpenAI] Erro ao gerar resposta: 400 Invalid value for 'content': expected a string, got null.
[POST Meta] URL: https://graph.facebook.com/v22.0/775904258949205/messages
[POST Meta] Body: {
  "messaging_product": "whatsapp",
  "to": "5511958711770",
  "type": "text",
  "text": {
    "body": "Desculpe Marcelo, estou com dificuldades t√©cnicas no momento. Pode repetir?"
  }
}
‚úÖ Resposta enviada com sucesso para 5511958711770
[POST Meta] Response: {
  "messaging_product": "whatsapp",
  "contacts": [
    {
      "input": "5511958711770",
      "wa_id": "5511958711770"
    }
  ],
  "messages": [
    {
      "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEkI4ODEyRTA4NTlGODU1Q0ZCMQA="
    }
  ]
}
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEkI4ODEyRTA4NTlGODU1Q0ZCMQA=",
                "status": "sent",
                "timestamp": "1763807695",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEkI4ODEyRTA4NTlGODU1Q0ZCMQA=",
                "status": "delivered",
                "timestamp": "1763807696",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEkI4ODEyRTA4NTlGODU1Q0ZCMQA=",
                "status": "delivered",
                "timestamp": "1763807696",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "1535276744056597",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "551153050027",
              "phone_number_id": "911344615386648"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Marcelo Ferracini"
                },
                "wa_id": "5511958711770"
              }
            ],
            "messages": [
              {
                "from": "5511958711770",
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBNEMxRDRCNTQ4MENDN0YwNjU4AA==",
                "timestamp": "1763807760",
                "type": "interactive",
                "interactive": {
                  "type": "call_permission_reply",
                  "call_permission_reply": {
                    "response": "reject",
                    "response_source": "user_action"
                  }
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: [
  {
    "from": "5511958711770",
    "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBNEMxRDRCNTQ4MENDN0YwNjU4AA==",
    "timestamp": "1763807760",
    "type": "interactive",
    "interactive": {
      "type": "call_permission_reply",
      "call_permission_reply": {
        "response": "reject",
        "response_source": "user_action"
      }
    }
  }
]
[Debug] Contatos extra√≠dos: [
  {
    "profile": {
      "name": "Marcelo Ferracini"
    },
    "wa_id": "5511958711770"
  }
]
Mensagem recebida de 5511958711770: undefined
[OpenAI] Gerando resposta...
[OpenAI] Erro ao gerar resposta: 400 Invalid value for 'content': expected a string, got null.
[POST Meta] URL: https://graph.facebook.com/v22.0/775904258949205/messages
[POST Meta] Body: {
  "messaging_product": "whatsapp",
  "to": "5511958711770",
  "type": "text",
  "text": {
    "body": "Desculpe Marcelo, estou com dificuldades t√©cnicas no momento. Pode repetir?"
  }
}
‚úÖ Resposta enviada com sucesso para 5511958711770
[POST Meta] Response: {
  "messaging_product": "whatsapp",
  "contacts": [
    {
      "input": "5511958711770",
      "wa_id": "5511958711770"
    }
  ],
  "messages": [
    {
      "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjIxOTA5NzJFRkI2Mzk3OUQyRAA="
    }
  ]
}
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjIxOTA5NzJFRkI2Mzk3OUQyRAA=",
                "status": "sent",
                "timestamp": "1763807766",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjIxOTA5NzJFRkI2Mzk3OUQyRAA=",
                "status": "delivered",
                "timestamp": "1763807766",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "1535276744056597",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "551153050027",
              "phone_number_id": "911344615386648"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Marcelo Ferracini"
                },
                "wa_id": "5511958711770"
              }
            ],
            "messages": [
              {
                "from": "5511958711770",
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBODY2MTlGQzBCOTlFNjE3NzA2AA==",
                "timestamp": "1763807852",
                "type": "interactive",
                "interactive": {
                  "type": "call_permission_reply",
                  "call_permission_reply": {
                    "response": "accept",
                    "expiration_timestamp": 1764412648,
                    "response_source": "user_action"
                  }
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: [
  {
    "from": "5511958711770",
    "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABIYFDNBODY2MTlGQzBCOTlFNjE3NzA2AA==",
    "timestamp": "1763807852",
    "type": "interactive",
    "interactive": {
      "type": "call_permission_reply",
      "call_permission_reply": {
        "response": "accept",
        "expiration_timestamp": 1764412648,
        "response_source": "user_action"
      }
    }
  }
]
[Debug] Contatos extra√≠dos: [
  {
    "profile": {
      "name": "Marcelo Ferracini"
    },
    "wa_id": "5511958711770"
  }
]
Mensagem recebida de 5511958711770: undefined
[OpenAI] Gerando resposta...
[OpenAI] Erro ao gerar resposta: 400 Invalid value for 'content': expected a string, got null.
[POST Meta] URL: https://graph.facebook.com/v22.0/775904258949205/messages
[POST Meta] Body: {
  "messaging_product": "whatsapp",
  "to": "5511958711770",
  "type": "text",
  "text": {
    "body": "Desculpe Marcelo, estou com dificuldades t√©cnicas no momento. Pode repetir?"
  }
}
‚úÖ Resposta enviada com sucesso para 5511958711770
[POST Meta] Response: {
  "messaging_product": "whatsapp",
  "contacts": [
    {
      "input": "5511958711770",
      "wa_id": "5511958711770"
    }
  ],
  "messages": [
    {
      "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjUzRDAzQzQyNDA2NDBFNTI0QgA="
    }
  ]
}
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjUzRDAzQzQyNDA2NDBFNTI0QgA=",
                "status": "sent",
                "timestamp": "1763807857",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjUzRDAzQzQyNDA2NDBFNTI0QgA=",
                "status": "delivered",
                "timestamp": "1763807857",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
[Webhook] üîî Evento recebido: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "808783645458695",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15556657611",
              "phone_number_id": "775904258949205"
            },
            "statuses": [
              {
                "id": "wamid.HBgNNTUxMTk1ODcxMTc3MBUCABEYEjUzRDAzQzQyNDA2NDBFNTI0QgA=",
                "status": "delivered",
                "timestamp": "1763807857",
                "recipient_id": "5511958711770",
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
[Debug] Mensagens extra√≠das: undefined
[Debug] Contatos extra√≠dos: undefined
